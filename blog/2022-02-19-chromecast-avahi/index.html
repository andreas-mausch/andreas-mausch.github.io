
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cast your screen to a Chromecast without Chrome</title>
    <link rel="stylesheet" href="/styles/style.css"/>
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" sizes="any"/>
  </head>
  <body>
    <header class="site-header">
      <div class="site-header-content">
        <a class="site-title" href="/">Andreas Mausch</a>
        <nav class="site-nav">
          <a href="#" class="menu-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              version="1.1"
              viewbox="0 0 16 16"
              width="100%"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5">
              <path d="m2.75 12.25h10.5m-10.5-4h10.5m-10.5-4h10.5"/>
            </svg>
          </a>
          <input id="nav-toggle" type="checkbox"/>
          <label class="nav-button-container" for="nav-toggle">
            <div class="nav-button"></div>
          </label>
          <ol class="site-nav-items">
            <a class="page-link" href="/"><li class="page-link-home">Home</li></a><a class="page-link" href="/whatsapp-viewer/"><li>WhatsApp Viewer</li></a><a class="page-link" href="/blog/"><li>Blog</li></a></ol>
        </nav>
      </div>
    </header>
    <div class="content">
      
<h1>Cast your screen to a Chromecast without Chrome</h1>
<div>
  <time class="postlist-date" datetime="2022-02-19T16:00:00.000+00:00">Feb 19, 2022</time>
</div>



<p>I tried to cast my screen to my TV (with a built-in Chromecast).</p>
<h1 id="tools-tested" tabindex="-1">1. Tools tested <a class="header-anchor" href="#tools-tested" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h1>
<h2 id="google-chrome-%2F-chromium" tabindex="-1">1.1. Google Chrome / Chromium <a class="header-anchor" href="#google-chrome-%2F-chromium" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>Best experience by far.
Streaming starts very fast and with very low delay (~0.5 seconds).</p>
<p>But I would like to not use Chrome if possible, and I think it's not the browser's job to cast my screen.
So I kept looking for some alternatives.</p>
<h2 id="miraclecast" tabindex="-1">1.2. miraclecast <a class="header-anchor" href="#miraclecast" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p><a href="https://github.com/albfan/miraclecast" class="external-link" target="_blank">https://github.com/albfan/miraclecast</a></p>
<p>This didn't work for me, and it is not fully <a href="https://github.com/albfan/miraclecast/issues/4" class="external-link" target="_blank">implemented yet</a>.</p>
<p>I was able to run <code class="language-plain">miracle-wifid</code>, but only after I disconnected from my normal wifi.
Also, <code class="language-plain">miracle-wifictl</code> hung when I ran the <code class="language-plain">p2p-scan</code> command.
I didn't investigate any further.</p>
<h2 id="gnome-network-displays" tabindex="-1">1.3. gnome-network-displays <a class="header-anchor" href="#gnome-network-displays" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p><a href="https://gitlab.gnome.org/GNOME/gnome-network-displays" class="external-link" target="_blank">https://gitlab.gnome.org/GNOME/gnome-network-displays</a></p>
<p>It found a TV nearby, but not mine.
My Fire TV stick was also not found, and is not supported.
Chromecast is also not supported: <a href="https://gitlab.gnome.org/GNOME/gnome-network-displays/-/issues/18" class="external-link" target="_blank">Issue</a></p>
<h2 id="castnow" tabindex="-1">1.4. castnow <a class="header-anchor" href="#castnow" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p><a href="https://github.com/xat/castnow" class="external-link" target="_blank">https://github.com/xat/castnow</a></p>
<p>Tool exclusivly to work with Chromecast.
I was able to find the Chromecast in my network and stream media to it.</p>
<p>Unfortunately, there is no built-in command to stream your desktop.
<a href="https://github.com/xat/castnow/issues/208" class="external-link" target="_blank">https://github.com/xat/castnow/issues/208</a></p>
<p>The only way it worked for me was using <code class="language-plain">ffmpeg</code>:</p>
<pre class="language-bash"><code class="language-bash"><button type="button" class="copy-to-clipboard"><i class="icon icon-copy"></i></button><span class="highlight-line">ffmpeg <span class="token parameter variable">-hide_banner</span> <span class="token parameter variable">-loglevel</span> error <span class="token parameter variable">-video_size</span> 3840x2160 <span class="token parameter variable">-framerate</span> <span class="token number">30</span> <span class="token parameter variable">-f</span> x11grab <span class="token parameter variable">-i</span> :0.0 <span class="token parameter variable">-vf</span> <span class="token string">"scale=iw/2:ih/2"</span> <span class="token parameter variable">-c:v</span> libx264 <span class="token parameter variable">-level</span> <span class="token number">3.0</span> <span class="token parameter variable">-pix_fmt</span> yuv420p <span class="token parameter variable">-x264opts</span> <span class="token assign-left variable">keyint</span><span class="token operator">=</span><span class="token number">2</span> <span class="token parameter variable">-crf</span> <span class="token number">23</span> <span class="token parameter variable">-preset</span> ultrafast <span class="token parameter variable">-tune</span> zerolatency <span class="token parameter variable">-f</span> mp4 <span class="token parameter variable">-movflags</span> frag_keyframe+faststart - <span class="token operator">|</span> castnow <span class="token parameter variable">--quiet</span> -</span></code></pre>
<p>However, the delay was very high (~10 seconds).</p>
<p>Also, I found that <code class="language-plain">ffmpeg</code> didn't output to stdout immediately, but had a delay itself.
I was able to reduce it by setting the <code class="language-plain">keyint</code> option. Still not perfect, but way faster.</p>
<h2 id="go-chromecast" tabindex="-1">1.5. go-chromecast <a class="header-anchor" href="#go-chromecast" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p><a href="https://github.com/vishen/go-chromecast" class="external-link" target="_blank">https://github.com/vishen/go-chromecast</a></p>
<p>Similar experience to <code class="language-plain">castnow</code>.</p>
<pre class="language-shell-session"><code class="language-shell-session"><button type="button" class="copy-to-clipboard"><i class="icon icon-copy"></i></button><span class="highlight-line"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">./go-chromecast <span class="token function">ls</span></span></span></span>
<span class="highlight-line"><span class="token output">1) device="2021/22 Philips UHD Android TV" device_name="Philips TV" address="192.168.1.23:8009" uuid="1234567890abcdef1234567890abcdef"</span></code></pre>
<pre class="language-bash"><code class="language-bash"><button type="button" class="copy-to-clipboard"><i class="icon icon-copy"></i></button><span class="highlight-line">./go-chromecast transcode --content-type video/mp4 <span class="token parameter variable">--command</span><span class="token operator">=</span><span class="token string">"ffmpeg -video_size 3840x2160 -framerate 10 -f x11grab -i :0.0 -c:v libx264 -level 3.0 -pix_fmt yuv420p -x264opts keyint=2 -crf 23 -preset ultrafast -tune zerolatency -f mp4 -movflags frag_keyframe+faststart -"</span></span></code></pre>
<h2 id="android%3A-miracast-widget" tabindex="-1">1.6. Android: miracast-widget <a class="header-anchor" href="#android%3A-miracast-widget" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p><a href="https://github.com/mattgmg1990/miracast-widget" class="external-link" target="_blank">https://github.com/mattgmg1990/miracast-widget</a></p>
<p>To cast your screen on Android without using the <em>Google Home</em> app, you can use this neat tool.</p>
<p>All it does is opening the Android built-in cast page.
I wasn't even able to open the page without this widget, maybe Samsung hides it in their menus(?).</p>
<p>But with this widget, casting the screen was super fast, just like using Google Chrome.</p>
<h1 id="difference-between-google-chrome-and-the-other-tools" tabindex="-1">2. Difference between Google Chrome and the other tools <a class="header-anchor" href="#difference-between-google-chrome-and-the-other-tools" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h1>
<p>I wondered how and why Google Chrome was faster to establish the connection and start the screen sharing.
Just from my feeling, it looks like it doesn't tell the Chromecast to &quot;stream a video&quot;,
but rather puts the Chromecast in a different mode.</p>
<p>With all other tools I see this loading screen for about a second before it starts the video streaming:</p>
<img src="/blog/2022-02-19-chromecast-avahi/chromecast-tv-loading.png" width="1913" height="1119" alt="undefined">
<p>But with Google Chrome, this screen does not show up at all.
Instead, the first frame I see is the casted screen.
So I'm pretty sure it should be possible to reverse engineer this
and see what exact commands Chrome sends to the Chromecast.</p>
<h1 id="chromecast-protocol" tabindex="-1">3. Chromecast Protocol <a class="header-anchor" href="#chromecast-protocol" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h1>
<h2 id="avahi" tabindex="-1">3.1. avahi <a class="header-anchor" href="#avahi" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>One thing I learned was how my laptop finds the Chromecast.
It uses <a href="https://en.wikipedia.org/wiki/Avahi_(software)" class="external-link" target="_blank">avahi</a>:</p>
<blockquote>
<p>Avahi is a system which enables programs to publish and discover services and hosts running on a local network.</p>
</blockquote>
<blockquote>
<p>Avahi implements the Apple Zeroconf specification, mDNS, DNS-SD and RFC 3927/IPv4LL.</p>
</blockquote>
<p>Find Chromecasts in your network:</p>
<pre class="language-shell-session"><code class="language-shell-session"><button type="button" class="copy-to-clipboard"><i class="icon icon-copy"></i></button><span class="highlight-line"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">avahi-browse <span class="token parameter variable">--verbose</span> --ignore-local <span class="token parameter variable">--resolve</span> <span class="token parameter variable">--terminate</span> _googlecast._tcp</span></span></span>
<span class="highlight-line"><span class="token output">Server version: avahi 0.8; Host name: neonew-lenovo.local</span>
<span class="highlight-line">E Ifce Prot Name                                          Type                 Domain</span>
<span class="highlight-line">+ wlp1s0 IPv4 2021/22-Philips-UHD--1234567890abcdef1234567890abcdef _googlecast._tcp     local</span>
<span class="highlight-line">= wlp1s0 IPv4 2021/22-Philips-UHD--1234567890abcdef1234567890abcdef _googlecast._tcp     local</span>
<span class="highlight-line">   hostname = [1a2b3c4d-5e6f-1a2b-3c4d-5e6f1a2b3c4d.local]</span>
<span class="highlight-line">   address = [192.168.1.23]</span>
<span class="highlight-line">   port = [8009]</span>
<span class="highlight-line">   txt = ["rs=Default Media Receiver" "nf=1" "bs=1A2B3C4D5E6F" "st=1" "ca=123456" "fn=Philips TV" "ic=/setup/icon.png" "md=2021/22 Philips UHD Android TV" "ve=05" "rm=" "cd=1A2B3C4D5E6F1A2B3C4D5E6F1A2B3C4D" "id=1234567890abcdef1234567890abcdef"]</span>
<span class="highlight-line">: Cache exhausted</span>
<span class="highlight-line">: All for now</span></code></pre>
<p>Find all services available via avahi:</p>
<pre class="language-bash"><code class="language-bash"><button type="button" class="copy-to-clipboard"><i class="icon icon-copy"></i></button><span class="highlight-line">avahi-browse <span class="token parameter variable">--all</span> <span class="token parameter variable">--verbose</span> --ignore-local <span class="token parameter variable">--resolve</span> <span class="token parameter variable">--terminate</span></span></code></pre>
<p>GUI:</p>
<pre class="language-bash"><code class="language-bash"><button type="button" class="copy-to-clipboard"><i class="icon icon-copy"></i></button><span class="highlight-line">avahi-discover</span></code></pre>
<h2 id="castv2" tabindex="-1">3.2. CASTV2 <a class="header-anchor" href="#castv2" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>CASTV2 is the name of the proprietary protocol Google Cast uses.
It wraps Protocol Buffers (Protobuf) messages in a TLS connection.</p>
<p>I've found <a href="https://github.com/dylanmckay/gcast/blob/master/PROTOCOL.md" class="external-link" target="_blank">https://github.com/dylanmckay/gcast/blob/master/PROTOCOL.md</a> and
<a href="https://github.com/thibauts/node-castv2" class="external-link" target="_blank">https://github.com/thibauts/node-castv2</a>.</p>
<p>Unfortunately, the private key used for device authentication is not available, so we cannot create an own server which
is accepted by the Google Chrome browser for example.</p>
<p>See here: <a href="https://github.com/thibauts/node-castv2/issues/2#issuecomment-45437332" class="external-link" target="_blank">https://github.com/thibauts/node-castv2/issues/2#issuecomment-45437332</a></p>
<img src="/blog/2022-02-19-chromecast-avahi/device-authentication.png" width="744" height="433" alt="undefined">
<p>Interestingly, there is an Android app called <a href="https://play.google.com/store/apps/details?id=com.softmedia.receiver.lite" class="external-link" target="_blank">AirReceiverLite</a>,
which emulates a Chromecast device and I was able to connect to it via Chrome.
<a href="https://github.com/thibauts/node-castv2/issues/2#issuecomment-885093688" class="external-link" target="_blank">Somebody says</a>:</p>
<blockquote>
<p>It's using predefined AuthResponse, most likely precomputed on a rooted chromecast. DRM not working. Not long till Google bans the certificate.</p>
</blockquote>
<p>That was in Jul 2021.</p>


<script async src="/scripts/index.js"></script>

    </div>
  </body>
</html>
