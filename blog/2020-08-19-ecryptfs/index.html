
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unable to login after uninstalling eCryptFS</title>
    <link rel="stylesheet" href="/styles/style.css"/>
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" sizes="any"/>
  </head>
  <body>
    <header class="site-header">
      <div class="site-header-content">
        <a class="site-title" href="/">Andreas Mausch</a>
        <nav class="site-nav">
          <a href="#" class="menu-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              version="1.1"
              viewbox="0 0 16 16"
              width="100%"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5">
              <path d="m2.75 12.25h10.5m-10.5-4h10.5m-10.5-4h10.5"/>
            </svg>
          </a>
          <input id="nav-toggle" type="checkbox"/>
          <label class="nav-button-container" for="nav-toggle">
            <div class="nav-button"></div>
          </label>
          <ol class="site-nav-items">
            <a class="page-link" href="/"><li class="page-link-home">Home</li></a><a class="page-link" href="/whatsapp-viewer/"><li>WhatsApp Viewer</li></a><a class="page-link" href="/blog/"><li>Blog</li></a></ol>
        </nav>
      </div>
    </header>
    <div class="content">
      
<h1>Unable to login after uninstalling eCryptFS</h1>
<div>
  <time class="postlist-date" datetime="2020-08-19T16:00:00.000+00:00">Aug 19, 2020</time>
</div>



<img src="/blog/2020-08-19-ecryptfs/unable-to-login.jpg" width="720" height="405" alt="undefined">
<h1 id="the-setup" tabindex="-1">1. The setup <a class="header-anchor" href="#the-setup" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h1>
<p>I've used eCryptFS for the several past years to secure the data in my home directory.</p>
<p>However it comes with a big limitation: Filenames cannot be longer than 144 chars (plus minus).
So this will fail on an eCryptFS'd directory:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">touch</span> xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span></code></pre>
<p>The limitation only applies to single filenames. The path in total can be longer than 144 chars.</p>
<p>Most of the times you won't have such long single filenames. However, for my new job I tried to clone a repo which contained long filenames.
I wasn't able to clone it because of eCryptFS. :(</p>
<h1 id="uninstall-ecryptfs" tabindex="-1">2. Uninstall eCryptFS <a class="header-anchor" href="#uninstall-ecryptfs" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h1>
<p>So I've decided to ditch it, since the files which required special security aren't on that drive anymore anyway.</p>
<p>I've found a good <a href="https://askubuntu.com/questions/4950/how-to-stop-using-built-in-home-directory-encryption" class="external-link" target="_blank">step-by-step tutorial</a> how to get rid of eCryptFS, however..</p>
<p><strong>PAM</strong></p>
<p>When I've installed eCryptFS, I've also changed the configuration of the <em>The Pluggable Authentication Modules</em> according to the <a href="https://wiki.archlinux.org/index.php/ECryptfs#Auto-mounting" class="external-link" target="_blank">Arch wiki</a>.
But I forgot about it, and didn't revert the changes on uninstallation.</p>
<p>As a consequence, I've uninstalled everything regarding eCryptFS, but my PAM config still pointed to it.</p>
<h1 id="the-lock-out" tabindex="-1">3. The lock-out <a class="header-anchor" href="#the-lock-out" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h1>
<p>This resulted in a lock-out of my own system.</p>
<p>I couldn't login anymore.<br>
Not even as <em>root</em>.</p>
<p>Fortunately I've already decryted all my data before.</p>
<p>My only choice to get the system running again was to use a Manjaro USB Boot.<br>
I've then reverted the changes in <em>/etc/pam.d/system-auth</em> and I was able to login again. Phew.</p>
<h1 id="alternative-to-ecryptfs" tabindex="-1">4. Alternative to eCryptFS <a class="header-anchor" href="#alternative-to-ecryptfs" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h1>
<p>Today I would try LUKS, which is also suggested by the official Manjaro installer.
It's full disk encryption vs. just your home folder.
The setup seems to be easier and more user-friendly.
And also, it doesn't have a limitation on the filename length.</p>


<script async src="/scripts/index.js"></script>

    </div>
  </body>
</html>
