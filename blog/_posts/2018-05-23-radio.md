---
layout: post
title:  "Radio"
date:   2018-05-23 23:00:00 +02:00
tags:
---

During the last weeks I wondered how radio works.
I wasn't able to find a good source which explains in simple words how the transformation of eletric current to radio waves is done.

I wonder if it's comparable to a lightbulb, which also transforms current to electromagnetic waves.
And I wonder if it's the opposite of the photoelectric effect, which takes photons to transform them into current.
Even the (usually really good) [Sendung mit der Maus](https://www.youtube.com/watch?v=Nc0tk8WemGg) couldn't really explain it to me. Armin rather focused on assembling pre-built components. :/

A lot of stuff is done via radio. Of course, there is FM/AM broadcasting, but there is way more:

- RFID
- Radar
- WiFi
- Bluetooth
- Amateur radio
- TV (DVB-T(2))
- CCTV / cameras
- Navigation (GPS / Galileo / GLONASS / Beidou)
- Mobile communications (GSM / 3G / LTE)

All of them use the same base technology.

If you have a radio which can send and receive on any frequency, you could use all of the above technologies with the same single device.
There is software which can take the raw radio wave and then run all the complicated [modulation](https://en.wikipedia.org/wiki/Modulation) on it to extract binary data. A radio which works with this kind of software is called [Software-defined radio](https://en.wikipedia.org/wiki/Software-defined_radio). Some radios are the [HackRF One](https://greatscottgadgets.com/hackrf/), the [bladeRF x40](https://www.nuand.com/blog/product/bladerf-x40/), the [LimeSDR](https://myriadrf.org/projects/limesdr/), the [Airspy](https://airspy.com/) and the [USRP](https://www.ettus.com/).

Luckily, there is also [RTL-SDR](https://www.rtl-sdr.com/about-rtl-sdr/), which stands for SDRs based on the very cheap RTL2832U chip. It's 10 EUR on ebay and works in the frequency range from 24 up to 1766 MHz, which doesn't work for WiFi/Bluetooth, but for example GSM. For me it was enough to play around have some fun with.

A nice tool to visualize the waves is [gqrx](http://gqrx.dk/). Connect the RTL-SDR, install gqrx (I used `sudo pacman -S gqrx` on Manjaro), select the frequency (I used 90.3 MHz for [NDR](https://www.ndr.de/903/index.html)), make sure the mode is set correctly in the dropdown (I used WFM mono), and you are ready to listen to radio on your computer.

![]({{ site.baseurl }}/images/2018-05-23-radio/notebook.jpg)

There is a good series on [YouTube](https://www.youtube.com/watch?v=PExa5sC4sbE) which shows how to receive GSM data and explains it's broken encryption.
I found it interesting and decided to try it myself.
For this, you need [gr-gsm](https://github.com/ptrkrysik/gr-gsm) and [Wireshark](https://www.wireshark.org/).

First, put your phone in GSM mode (2G) and find out which channel it uses.
For my Samsung S7, I could dial `*#0011#` and it showed me the following screen:

![]({{ site.baseurl }}/images/2018-05-23-radio/samsung-gsm-arfcn.png)

We are interested in the BCCH arfcn (in this case 121), which we can put in an [online calculator](https://www.cellmapper.net/arfcn) which will give us the up- and downlink frequencies (in my case 959.2 MHz for downlink).

Install gr-gsm (On my machine via `yaourt -S gr-gsm-git`, see also [here](https://github.com/ptrkrysik/gr-gsm)), and run

```bash
grgsm_livemon
```

Enter the frequency in the following screen, and gr-gsm will start to convert the radio waves to binary GSM packages and send them to the loopback network interface of your machine.

![]({{ site.baseurl }}/images/2018-05-23-radio/grgsm-livemon.png)

Now if you open Wireshark and select the loopback device, you can see real GSM packages:

![]({{ site.baseurl }}/images/2018-05-23-radio/wireshark-gsm.png)

You can apply different filters. Just start typing gsm in the filter field and suggestions will pop up.
Please note that some packages might get lost.

Of course, GSM transfer is encrypted. So you cannot just read SMS in plain text.
However, lots of device use the A5/1 algorithm, which can be fairly easy broken by using a 2 TB rainbow table.
My particular phone (Samsung S7) uses the A5/3 algorithm instead, which is harder to attack, so I stopped here.
