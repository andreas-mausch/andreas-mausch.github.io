
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protractor: Geolocation in Google Chrome</title>
    <link rel="stylesheet" href="/styles/style.css"/>
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" sizes="any"/>
  </head>
  <body>
    <header class="site-header">
      <div class="site-header-content">
        <a class="site-title" href="/">Andreas Mausch</a>
        <nav class="site-nav">
          <a href="#" class="menu-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              version="1.1"
              viewbox="0 0 16 16"
              width="100%"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5">
              <path d="m2.75 12.25h10.5m-10.5-4h10.5m-10.5-4h10.5"/>
            </svg>
          </a>
          <input id="nav-toggle" type="checkbox"/>
          <label class="nav-button-container" for="nav-toggle">
            <div class="nav-button"></div>
          </label>
          <ol class="site-nav-items">
            <a class="page-link" href="/"><li class="page-link-home">Home</li></a><a class="page-link" href="/whatsapp-viewer/"><li>WhatsApp Viewer</li></a><a class="page-link" href="/blog/"><li>Blog</li></a></ol>
        </nav>
      </div>
    </header>
    <div class="content">
      
<h1>Protractor: Geolocation in Google Chrome</h1>
<div>
  <time class="postlist-date" datetime="2015-12-14T05:00:00.000+00:00">Dec 14, 2015</time>
</div>



<p>I am currently developing a hybrid app using Ionic.
<a href="http://ionicframework.com" class="external-link" target="_blank">http://ionicframework.com</a><br>
For end-to-end tests, they recommend Protractor. <a href="http://www.protractortest.org" class="external-link" target="_blank">http://www.protractortest.org</a><br>
Furthermore, I use a <a href="https://github.com/SeleniumHQ/docker-selenium" class="external-link" target="_blank">Selenium docker container</a>.</p>
<p>As many other apps, I make use of geolocation to receive the user's position.
However, when I tried to run a test with geolocation, it failed. I then used VNC to see if there is any error message, and I discovered Google Chrome prompts the user to allow or disallow geolocation. I searched the internet for answers, but couldn't find any. <a href="http://stackoverflow.com/questions/23431059/how-to-mock-call-to-navigator-geolocation-in-protractor-tests" class="external-link" target="_blank">This</a> didn't work for me.</p>
<p>On the Selenium website they describe a way to change the preferences passed to the GoogleDriver using the ChromeOptions. After some more experimenting I found there is an option &quot;<strong>profile.default_content_setting_values.geolocation</strong>&quot;. If this is set to 1, the browser will no longer ask the user for permission.<br>
Happy testing!</p>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-js"><code data-filename="protractor.conf.js" class="language-js"><span class="highlight-line">exports<span class="token punctuation">.</span>config <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">  <span class="token literal-property property">capabilities</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token literal-property property">browserName</span><span class="token operator">:</span> <span class="token string">"chrome"</span><span class="token punctuation">,</span></span>
<span class="highlight-line">    <span class="token literal-property property">chromeOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">      <span class="token literal-property property">prefs</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token string-property property">"profile.default_content_setting_values.geolocation"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="highlight-line">      <span class="token punctuation">}</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="highlight-line">  <span class="token comment">// ... rest of your configuration</span></span></code></pre>

    </div><p>Oh, and now I found there is an issue about this topic with the same answer <a href="https://github.com/angular/protractor/issues/2626" class="external-link" target="_blank">here</a>.</p>
<p><strong>UPDATE</strong></p>
<p>Ok, the reason why the mocked version of stackoverflow.com (see above) didn't work for me was the timing. My app immediately tries to get the location, right after page load. The execution of browser.executeScript() just takes too long to have any effect, the geolocation has already been processed. After inserting a manual setTimeout(..., 1000) it worked. BUT: I do not want to have any artificial delay just to get my tests right. Ummm...have to think about that...</p>
<p>At some point there will be a locate-me-now-button, so I will probably make my tests click that button after executeScript(fakeGps). It is not exactly what happens at user's end, but I think it will be good enough for the test. :|</p>


<script async src="/scripts/index.js"></script>

    </div>
  </body>
</html>
