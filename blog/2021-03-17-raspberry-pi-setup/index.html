
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raspberry Pi Headless Setup</title>
    <link rel="stylesheet" href="/styles/style.css"/>
    <link rel="stylesheet" href="/styles/icons/iconism.css"/>
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" sizes="any"/>
  </head>
  <body>
    <header class="site-header">
      <div class="site-header-content">
        <a class="site-title" href="/">Andreas Mausch</a>
        <nav class="site-nav">
          <a href="#" class="menu-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              version="1.1"
              viewbox="0 0 16 16"
              width="100%"
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5">
              <path d="m2.75 12.25h10.5m-10.5-4h10.5m-10.5-4h10.5"/>
            </svg>
          </a>
          <input id="nav-toggle" type="checkbox"/>
          <label class="nav-button-container" for="nav-toggle">
            <div class="nav-button"></div>
          </label>
          <ol class="site-nav-items">
            <a class="page-link" href="/"><li class="page-link-home">Home</li></a><a class="page-link" href="/whatsapp-viewer/"><li>WhatsApp Viewer</li></a><a class="page-link" href="/blog/"><li>Blog</li></a></ol>
        </nav>
      </div>
    </header>
    <div class="content">
      
<h1>Raspberry Pi Headless Setup</h1>
<div>
  <time class="postlist-date" datetime="2021-03-17T18:00:00.000+00:00">Mar 17, 2021</time>
  <ul class="tags">
    
        
          <li><a href="/blog/tags/headless">#headless</a></li>
        
    
        
    
        
          <li><a href="/blog/tags/raspberrypi">#raspberrypi</a></li>
        
    
        
          <li><a href="/blog/tags/single%20board%20computer">#single board computer</a></li>
        
    
        
          <li><a href="/blog/tags/ssh">#ssh</a></li>
        
    
        
          <li><a href="/blog/tags/wifi">#wifi</a></li>
        
    
  </ul>
</div>


  <aside>
    <nav class="toc">
                <ol>
                    
                    <li><a href="#headless-setup">1. Headless setup</a>
            
                <ol>
                    
                    <li><a href="#flash">1.1. Flash</a>
            		</li>

                    <li><a href="#mount">1.2. Mount</a>
            		</li>

                    <li><a href="#ssh">1.3. SSH</a>
            		</li>

                    <li><a href="#wifi">1.4. WiFi</a>
            		</li>

                    <li><a href="#hostname">1.5. Hostname</a>
            		</li>

                    <li><a href="#after-first-boot">1.6. After first boot</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#backup-and-editing">2. Backup and editing</a>
            
                <ol>
                    
                    <li><a href="#create-a-full-backup-of-the-sd-card">2.1. Create a full backup of the SD card</a>
            		</li>

                    <li><a href="#make-the-backup-file-immutable%2C-if-needed">2.2. Make the backup file immutable, if needed</a>
            		</li>

                    <li><a href="#create-devices-for-mounting-partitions-from-the-backup-file">2.3. Create devices for mounting partitions from the backup file</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#qemu-testing">3. QEMU testing</a>
            
                <ol>
                    
                    <li><a href="#mount-and-edit-ld.so.preload">3.1. Mount and edit ld.so.preload</a>
            		</li>

                    <li><a href="#unmount-and-convert-(optional)">3.2. Unmount and convert (optional)</a>
            		</li>

                    <li><a href="#download-kernel-and-run">3.3. Download kernel and run</a>
            		</li>

                    <li><a href="#convert-qemu-image-back-to-raw">3.4. Convert QEMU image back to raw</a>
            		</li>
                </ol>
            		</li>
                </ol>
            </nav>
  </aside>


<h1 id="headless-setup" tabindex="-1">1. Headless setup <a class="header-anchor" href="#headless-setup" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h1>
<p><strong>This guide is outdated and Raspbian 12 Bookworm setups won't work.</strong>
I will write a new guide soon.</p>
<p>The <em>Backup</em> and <em>QEMU</em> sections below should still work (I hope).</p>
<hr>
<p>I've done this a couple of times already so I thought I should write it down.</p>
<p>How to setup the Raspberry Pi with <a href="https://www.raspberrypi.com/software/operating-systems/#raspberry-pi-os-64-bit" class="external-link" target="_blank">Pi OS</a>
for ssh and wifi.</p>
<h2 id="flash" tabindex="-1">1.1. Flash <a class="header-anchor" href="#flash" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>Flash the OS to the sd card.
<s>My favorite tool for this is <a href="https://www.balena.io/etcher/" class="external-link" target="_blank">Balana Etcher</a>.</s></p>
<p>I like to use <code class="language-plain">xzcat</code> in combination with <code class="language-plain">dd</code>:</p>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line">xzcat <span class="token number">2024</span>-03-15-raspios-bookworm-armhf-lite.img.xz <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">dd</span> <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/mmcbzz0 <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">oflag</span><span class="token operator">=</span>sync <span class="token assign-left variable">status</span><span class="token operator">=</span>progress</span></code></pre>

    </div><h2 id="mount" tabindex="-1">1.2. Mount <a class="header-anchor" href="#mount" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>After the flash is complete, mount the sd card to apply modifications.
I will use <em>/tmp/sdcard/</em> as mounting point in this example.</p>
<h2 id="ssh" tabindex="-1">1.3. SSH <a class="header-anchor" href="#ssh" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token builtin class-name">cd</span> /tmp/sdcard/boot/</span>
<span class="highlight-line"><span class="token function">touch</span> <span class="token function">ssh</span></span></code></pre>

    </div><h2 id="wifi" tabindex="-1">1.4. WiFi <a class="header-anchor" href="#wifi" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>Create this file:</p>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-plain"><code data-filename="/tmp/sdcard/boot/wpa_supplicant.conf" class="language-plain"><span class="highlight-line">country=US</span>
<span class="highlight-line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span>
<span class="highlight-line">update_config=1</span>
<span class="highlight-line"></span>
<span class="highlight-line">network={</span>
<span class="highlight-line">    ssid="your_real_wifi_ssid"</span>
<span class="highlight-line">    psk="your_real_password"</span>
<span class="highlight-line">    key_mgmt=WPA-PSK</span>
<span class="highlight-line">}</span></code></pre>

    </div><h2 id="hostname" tabindex="-1">1.5. Hostname <a class="header-anchor" href="#hostname" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>Edit <em>/tmp/sdcard/rootfs/etc/hostname</em> to change the hostname.</p>
<h2 id="after-first-boot" tabindex="-1">1.6. After first boot <a class="header-anchor" href="#after-first-boot" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>Change your password (run this on the pi):</p>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">passwd</span></span></code></pre>

    </div><p>Add your ssh key (run this on your local machine, replace the hostname):</p>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line">ssh-copy-id pi@raspberrypi</span></code></pre>

    </div><h1 id="backup-and-editing" tabindex="-1">2. Backup and editing <a class="header-anchor" href="#backup-and-editing" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h1>
<h2 id="create-a-full-backup-of-the-sd-card" tabindex="-1">2.1. Create a full backup of the SD card <a class="header-anchor" href="#create-a-full-backup-of-the-sd-card" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">sudo</span> <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/sdb <span class="token assign-left variable">of</span><span class="token operator">=</span>./raspberrypi.raw.img <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">status</span><span class="token operator">=</span>progress</span></code></pre>

    </div><h2 id="make-the-backup-file-immutable%2C-if-needed" tabindex="-1">2.2. Make the backup file immutable, if needed <a class="header-anchor" href="#make-the-backup-file-immutable%2C-if-needed" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">sudo</span> chattr +i raspberrypi.raw.img</span>
<span class="highlight-line">lsattr raspberrypi.raw.img</span></code></pre>

    </div><h2 id="create-devices-for-mounting-partitions-from-the-backup-file" tabindex="-1">2.3. Create devices for mounting partitions from the backup file <a class="header-anchor" href="#create-devices-for-mounting-partitions-from-the-backup-file" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">sudo</span> kpartx <span class="token parameter variable">-arv</span> raspberrypi.raw.img</span></code></pre>

    </div><p>(-a: Add partition mappings, -r: Read-only partition mappings, -v: Operate verbosely)</p>
<p>You can now mount the partitions, read files, do changes if needed, and unmount them again.</p>
<p>Afterwords, delete the devices:</p>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">sudo</span> kpartx <span class="token parameter variable">-dv</span> retropie.raw.img</span></code></pre>

    </div><p>(-d: Delete partition mappings)</p>
<h1 id="qemu-testing" tabindex="-1">3. QEMU testing <a class="header-anchor" href="#qemu-testing" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h1>
<p>Taken from <a href="https://gist.github.com/plembo/c4920016312f058209f5765cb9a3a25e" class="external-link" target="_blank">plembo</a> and <a href="https://github.com/dhruvvyas90/qemu-rpi-kernel/wiki" class="external-link" target="_blank">qemu-rpi-kernel</a>.</p>
<h2 id="mount-and-edit-ld.so.preload" tabindex="-1">3.1. Mount and edit ld.so.preload <a class="header-anchor" href="#mount-and-edit-ld.so.preload" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<p>Mount the <code class="language-plain">.img</code> file via <code class="language-plain">kpartx</code> to modify it, see above.</p>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">sudo</span> <span class="token function">nano</span> /mnt/etc/ld.so.preload</span>
<span class="highlight-line"><span class="token comment"># Comment out the only line</span></span></code></pre>

    </div><h2 id="unmount-and-convert-(optional)" tabindex="-1">3.2. Unmount and convert (optional) <a class="header-anchor" href="#unmount-and-convert-(optional)" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line">qemu-img convert <span class="token parameter variable">-f</span> raw <span class="token parameter variable">-O</span> qcow2 raspberrypi.raw.img raspberrypi.qcow2</span></code></pre>

    </div><h2 id="download-kernel-and-run" tabindex="-1">3.3. Download kernel and run <a class="header-anchor" href="#download-kernel-and-run" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line"><span class="token function">wget</span> https://github.com/dhruvvyas90/qemu-rpi-kernel/blob/9fb4fcf463df4341dbb7396df127374214b90841/kernel-qemu-4.14.79-stretch?raw<span class="token operator">=</span>true</span>
<span class="highlight-line"><span class="token function">wget</span> https://github.com/dhruvvyas90/qemu-rpi-kernel/blob/9fb4fcf463df4341dbb7396df127374214b90841/versatile-pb.dtb?raw<span class="token operator">=</span>true</span>
<span class="highlight-line"><span class="token function">sudo</span> qemu-system-arm <span class="token parameter variable">-kernel</span> kernel-qemu-4.14.79-stretch <span class="token punctuation">\</span></span>
<span class="highlight-line">              <span class="token parameter variable">-cpu</span> arm1176 <span class="token parameter variable">-m</span> <span class="token number">256</span> <span class="token punctuation">\</span></span>
<span class="highlight-line">              <span class="token parameter variable">-M</span> versatilepb <span class="token parameter variable">-dtb</span> versatile-pb.dtb <span class="token punctuation">\</span></span>
<span class="highlight-line">              -no-reboot <span class="token punctuation">\</span></span>
<span class="highlight-line">              <span class="token parameter variable">-serial</span> stdio <span class="token punctuation">\</span></span>
<span class="highlight-line">              <span class="token parameter variable">-append</span> <span class="token string">"root=/dev/sda2 panic=1 rootfstype=ext4 rw"</span> <span class="token punctuation">\</span></span>
<span class="highlight-line">              <span class="token parameter variable">-hda</span> raspberrypi.qcow2 <span class="token punctuation">\</span></span>
<span class="highlight-line">              <span class="token parameter variable">-net</span> nic <span class="token parameter variable">-net</span> user <span class="token punctuation">\</span></span>
<span class="highlight-line">              <span class="token parameter variable">-net</span> tap,ifname<span class="token operator">=</span>vnet0,script<span class="token operator">=</span>no,downscript<span class="token operator">=</span>no</span></code></pre>

    </div><p>If you want to use a raw image instead of qcow2, you can pass <code class="language-plain">-drive format=raw,file=raspberrypi.raw.img</code>
instead of the <code class="language-plain">-hda</code> option.</p>
<h2 id="convert-qemu-image-back-to-raw" tabindex="-1">3.4. Convert QEMU image back to raw <a class="header-anchor" href="#convert-qemu-image-back-to-raw" aria-hidden="true"><svg viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a></h2>
<div class="code-block">
    <button type="button" class="copy-to-clipboard">
      <i class="icon icon-copy"></i>
    </button>
    <pre class="language-bash"><code class="language-bash"><span class="highlight-line">qemu-img <span class="token function">dd</span> <span class="token parameter variable">-f</span> qcow2 <span class="token parameter variable">-O</span> raw <span class="token assign-left variable">bs</span><span class="token operator">=</span>4M <span class="token assign-left variable">if</span><span class="token operator">=</span>raspberrypi.qcow2 <span class="token assign-left variable">of</span><span class="token operator">=</span>back-to.raw.img</span></code></pre>

    </div>

<script async src="/scripts/index.js"></script>

    </div>
  </body>
</html>
